<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>Coach Panel - SportZone</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="navbar">
    <div class="logo"><h1>SPORT<span>sport</span></h1></div>
    <div class="nav-right">
        <button class="lang-btn" onclick="toggleLanguage()" id="langBtn">KZ / RU</button>
        <button class="logout-btn" onclick="logout()">–®—ã“ì—É</button>
    </div>
</header>

    <div class="container">
        <div id="coachProfile" class="coach-card">
            </div>

        <div class="geo-section card" style="background: #1a1a1a; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h3><i class="fas fa-map-marker-alt"></i> –õ–æ–∫–∞—Ü–∏—è</h3>
            <button class="save-btn" style="width: auto; padding: 10px 20px;" onclick="getLocation()">“ö“±—Ä—ã–ª“ì—ã –ª–æ–∫–∞—Ü–∏—è—Å—ã–Ω–∞ —Ä“±“õ—Å–∞—Ç –±–µ—Ä—É</button>
            <p id="currentPos" style="margin-top: 10px; color: #ccff00;"></p>
        </div>

        <h3 id="athTitle">–ú–ï–ù–Ü“¢ –°–ü–û–†–¢–®–´–õ–ê–†–´–ú</h3>
        <div id="myAthletes" class="athlete-grid"></div>
    </div>

    <script>
        // –¢—ñ–ª–¥—ñ–∫ –±–∞–∑–∞
const translations = {
    KZ: {
        mainTitle: "–ë–ê–°“ö–ê–†–£ –ü–ê–ù–ï–õ–Ü",
        addCoach: "–ñ–ê–¢–¢–´“ö–¢–´–†–£–®–´ “ö–û–°–£",
        saveBtn: "–°–ê“ö–¢–ê–£",
        coachName: "–ê—Ç—ã-–∂”©–Ω—ñ",
        eventLabel: "–ñ–∞—Ä—ã—Å –º–µ—Ä–∑—ñ–º—ñ:",
        athTitle: "–ú–ï–ù–Ü“¢ –°–ü–û–†–¢–®–´–õ–ê–†–´–ú",
        uploadPhoto: "–§–æ—Ç–æ –∂“Ø–∫—Ç–µ—É",
        logout: "–®–´“í–£"
    },
    RU: {
        mainTitle: "–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø",
        addCoach: "–î–û–ë–ê–í–ò–¢–¨ –¢–†–ï–ù–ï–†–ê",
        saveBtn: "–°–û–•–†–ê–ù–ò–¢–¨",
        coachName: "–§–ò–û",
        eventLabel: "–°—Ä–æ–∫–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è:",
        athTitle: "–ú–û–ò –°–ü–û–†–¢–°–ú–ï–ù–´",
        uploadPhoto: "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ",
        logout: "–í–´–•–û–î"
    }
};

let currentLang = localStorage.getItem('siteLang') || 'KZ';

function toggleLanguage() {
    // –¢—ñ–ª–¥—ñ –∞—É—ã—Å—Ç—ã—Ä—É
    currentLang = currentLang === 'KZ' ? 'RU' : 'KZ';
    localStorage.setItem('siteLang', currentLang); // –¢–∞“£–¥–∞—É–¥—ã —Å–∞“õ—Ç–∞–ø “õ–æ—é
    applyLanguage();
}

function applyLanguage() {
    const t = translations[currentLang];

    // –ú”ô—Ç—ñ–Ω–¥–µ—Ä–¥—ñ ID –∞—Ä“õ—ã–ª—ã –∞—É—ã—Å—Ç—ã—Ä—É (–µ–≥–µ—Ä –æ–ª–∞—Ä –±–µ—Ç—Ç–µ –±–æ–ª—Å–∞)
    if(document.getElementById('mainTitle')) document.getElementById('mainTitle').innerText = t.mainTitle;
    if(document.getElementById('addCoachBtnTxt')) document.getElementById('addCoachBtnTxt').innerText = t.addCoach;
    if(document.getElementById('athTitle')) document.getElementById('athTitle').innerText = t.athTitle;
    
    // –ë–∞—Ç—ã—Ä–º–∞ –º”ô—Ç—ñ–Ω—ñ–Ω –∂–∞“£–∞—Ä—Ç—É
    document.getElementById('langBtn').innerText = currentLang === 'KZ' ? "KZ / RU" : "RU / KZ";

    // –ï–≥–µ—Ä –±–µ—Ç—Ç–µ –∂–∞—Ç—Ç—ã“õ—Ç—ã—Ä—É—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ –±–æ–ª—Å–∞, –æ–ª–∞—Ä–¥—ã “õ–∞–π—Ç–∞ –∂“Ø–∫—Ç–µ—É (render —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω —à–∞“õ—ã—Ä—É)
    if (typeof render === "function") render(); 
    if (typeof renderCoachInfo === "function") renderCoachInfo();
}

// –ë–µ—Ç –∂“Ø–∫—Ç–µ–ª–≥–µ–Ω–¥–µ —Ç—ñ–ª–¥—ñ –±—ñ—Ä–¥–µ–Ω “õ–æ–ª–¥–∞–Ω—É
document.addEventListener('DOMContentLoaded', applyLanguage);
        const coachData = JSON.parse(localStorage.getItem('loggedCoach'));
        if (!coachData) window.location.href = 'coach_login.html';

        function renderCoachInfo() {
            const profile = document.getElementById('coachProfile');
            profile.innerHTML = `
                <div class="coach-main-info">
                    <img src="${coachData.photo || 'https://via.placeholder.com/80'}" class="coach-img-circle">
                    <div>
                        <h2>${coachData.name}</h2>
                        <p style="color: #ccff00">${coachData.rank} (${coachData.sport})</p>
                    </div>
                </div>
                <div class="event-details">
                    <div><b>–ñ–∞—Ä—ã—Å:</b> ${coachData.event}</div>
                    <div><b>–ú–µ—Ä–∑—ñ–º—ñ:</b> ${coachData.start} / ${coachData.end}</div>
                    <div><b>–ê–¥–º–∏–Ω –±–µ–ª–≥—ñ–ª–µ–≥–µ–Ω –æ—Ä—ã–Ω:</b> <a href="${coachData.geo}" target="_blank" style="color:#00d4ff">üó∫ –ö”©—Ä—É</a></div>
                </div>
                <p style="font-size: 12px; color: #888; margin-top: 10px;">* –ë“±–ª –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–µ–∫ –ê–¥–º–∏–Ω ”©–∑–≥–µ—Ä—Ç–µ –∞–ª–∞–¥—ã.</p>
            `;

            const athList = document.getElementById('myAthletes');
            athList.innerHTML = '';
            coachData.athletes.forEach((ath, idx) => {
                athList.innerHTML += `
                    <div class="athlete-card">
                        <img src="${ath.photo || 'https://via.placeholder.com/100'}" class="athlete-thumb" style="width: 80px; height: 80px;">
                        <div>
                            <b>${ath.name}</b><br>
                            <small>${ath.dob}</small><br>
                            <input type="file" id="file-${idx}" style="display:none" onchange="updatePhoto(${idx})">
                            <button class="mini-add-btn" onclick="document.getElementById('file-${idx}').click()" style="margin-top:5px">
                                <i class="fas fa-camera"></i> –§–æ—Ç–æ –∂“Ø–∫—Ç–µ—É
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        async function updatePhoto(athIdx) {
            const file = document.getElementById(`file-${athIdx}`).files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function() {
                // 1. –ñ–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ –¥–∏—Å–ø–ª–µ–π–¥—ñ –∂–∞“£–∞—Ä—Ç—É
                coachData.athletes[athIdx].photo = reader.result;
                
                // 2. –ù–µ–≥—ñ–∑–≥—ñ –î–µ—Ä–µ–∫—Ç–µ—Ä “õ–æ—Ä—ã–Ω (sportDB) –∂–∞“£–∞—Ä—Ç—É
                let db = JSON.parse(localStorage.getItem('sportDB'));
                const coachIdx = db[coachData.sport].findIndex(c => c.login === coachData.login);
                db[coachData.sport][coachIdx].athletes[athIdx].photo = reader.result;
                
                localStorage.setItem('sportDB', JSON.stringify(db));
                localStorage.setItem('loggedCoach', JSON.stringify(coachData));
                alert("–§–æ—Ç–æ —Å–∞“õ—Ç–∞–ª–¥—ã! –ê–¥–º–∏–Ω –æ–Ω—ã –∫”©—Ä–µ –∞–ª–∞–¥—ã.");
                renderCoachInfo();
            };
            reader.readAsDataURL(file);
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    document.getElementById('currentPos').innerText = 
                        `–°—ñ–∑–¥—ñ“£ “õ–∞–∑—ñ—Ä–≥—ñ –ª–æ–∫–∞—Ü–∏—è“£—ã–∑: ${pos.coords.latitude.toFixed(4)}, ${pos.coords.longitude.toFixed(4)}`;
                });
            } else {
                alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è–Ω—ã –±—Ä–∞—É–∑–µ—Ä—ñ“£—ñ–∑ “õ–æ–ª–¥–∞–º–∞–π–¥—ã.");
            }
        }

        function logout() {
            localStorage.removeItem('loggedCoach');
            window.location.href = 'coach_login.html';
        }

        renderCoachInfo();
    </script>
</body>
</html>